pipeline {
    agent {
        docker {
            image 'maven:3.8.1-openjdk-11'
           // label 'docker-agent' // Optional, but useful if multiple templates
           // args '-v /var/run/docker.sock:/var/run/docker.sock' // For "Docker in Docker" scenarios
        }
    }
    stages {
        stage('code -checkout') {
            steps {
                script {
              //  dir('secondary-repo-dir') {
                  git branch: 'main', credentialsId: 'PAT jenkins', url: 'https://github.com/shashwatrishi/Java-Mysql-Simple-Login-Web-application.git'
                      sh 'ls -al'
					  sh 'pwd'
                   // }
                }
            }
        }
   
        stage('Build Java Application') {
            steps {
                // Runs the Maven command to clean and package the application.
                // Assumes a pom.xml file is in the root directory.
                // 'sh' runs the command on Linux/macOS agents. Use 'bat' for Windows agents
               	sh 'ls -al'
				//sh 'cd secondary-repo-dir'
   				sh 'ls -al'
                sh 'mvn clean package -DskipTests'
            }
        }
		
		stage('Build Docker Image') {
            steps {
                // Builds a Docker image using the Dockerfile in the root directory.
                // The image is tagged with "my-java-app:latest" and the current build number.
                script {
                    def app = docker.build("my-java-app:${env.BUILD_NUMBER}")
                    // Optionally, run the image
                    // app.run()
                }
            }
        }
	}	
}
